import sqlite3
import app
import pandas as pd
import numpy as np
import csvprocessing as cp
import geometry_tools as gt
import json
from shapely.geometry import mapping, MultiPoint, Point
import re
import time
from datetime import datetime
import urllib
import urllib.request
import collections



# csvDf = pd.read_csv("/Users/apple/Desktop/python/internship/web_vue/web_viewer_back/data/snifferdrone/N1_15_2.8_20220620_153056.csv")
# cleanedDf = cp.clean_flight_log("-buffer", csvDf)
# # print(cleanedDf)
# # # # end = time.time()
# # # # print(end-start)

# # add a column of points
# gt.add_points_to_df(cleanedDf)
# points = gt.series_to_multipoint(cleanedDf["points"])
# # pre project the points to prepare for buffer.
# sr = gt.find_utm_zone(points[0].y, points[0].x)
# points = gt.reproject(points, sr)


# # cleanedDf["UtmLong"] = [i.x for i in points]
# # cleanedDf["UtmLat"] = [i.y for i in points]
# # print(cleanedDf)

# buff = points.buffer(15, resolution=8)
# geo_j = mapping(buff)
# # geometry = json.loads(app.toEsriGeometry(geo_j))
# print(app.toEsriGeometry(geo_j))

# print(geometry)
def get_token(userName, passWord):
    referer = "http://www.arcgis.com/"
    query_dict = {'username': userName, 'password': passWord,
                    'referer': referer, 'expiration': 900}
    query_string = urllib.parse.urlencode(query_dict).encode('utf-8')
    url = "https://www.arcgis.com/sharing/rest/generateToken"
    token = json.loads(urllib.request.urlopen(url + "?f=json", query_string).read())

    if "token" not in token:
        print(token['error'])
        return None
    else:
        #print(f"Authenticated as {self.username}")
        return token["token"]

def add_feature(token, geometry):
    features = [
            {
                "attributes" : {
                "Flight_Date" : "8/10/2022, 11:25 AM",
                "SenseLat" : 42.4,
                "SenseLong" : -83.55,
                "CH4" : 0,
                "Source_Name" : "test_Source_Name.csv",
                "BUFF_DIST": 15,
                "ORIG_FID": 1
                }
                # "geometry" :
                # {"rings": [[[289153.8256086962, 4698014.516955851], [289153.5646950932, 4698011.867855582], [289152.7919810475, 4698009.320558752], [289151.53716152656, 4698006.9729565475], [289149.84845854086, 4698004.915266006], [289147.7907679992, 4698003.226563021], [289145.44316579495, 4698001.9717435], [289142.89586896444, 4698001.199029454], [289140.24676869623, 4698000.938115851], [289137.59766842803, 4698001.199029454], [289135.0503715975, 4698001.9717435], [289132.7027693933, 4698003.226563021], [289130.6450788516, 4698004.915266006], [289128.9563758659, 4698006.9729565475], [289127.701556345, 4698009.320558752], [289126.92884229927, 4698011.867855582], [289126.66792869626, 4698014.516955851], [289126.92884229927, 4698017.166056119], [289127.701556345, 4698019.713352949], [289128.9563758659, 4698022.060955154], [289130.6450788516, 4698024.118645695], [289132.7027693933, 4698025.807348681], [289135.0503715975, 4698027.062168201], [289137.59766842803, 4698027.834882247], [289140.24676869623, 4698028.09579585], [289142.89586896444, 4698027.834882247], [289145.44316579495, 4698027.062168201], [289147.7907679992, 4698025.807348681], [289149.84845854086, 4698024.118645695], [289151.53716152656, 4698022.060955154], [289152.7919810475, 4698019.713352949], [289153.5646950932, 4698017.166056119], [289153.8256086962, 4698014.516955851]], [[289152.8313806838, 4697939.923694723], [289152.5704670808, 4697937.274594455], [289151.7977530351, 4697934.727297625], [289150.54293351417, 4697932.37969542], [289148.85423052846, 4697930.322004879], [289146.7965399868, 4697928.633301893], [289144.44893778255, 4697927.3784823725], [289141.90164095204, 4697926.605768327], [289139.25254068384, 4697926.344854724], [289136.60344041564, 4697926.605768327], [289134.0561435851, 4697927.3784823725], [289131.7085413809, 4697928.633301893], [289129.6508508392, 4697930.322004879], [289127.9621478535, 4697932.37969542], [289126.7073283326, 4697934.727297625], [289125.9346142869, 4697937.274594455], [289125.67370068387, 4697939.923694723], [289125.9346142869, 4697942.572794992], [289126.7073283326, 4697945.120091822], [289127.9621478535, 4697947.467694026], [289129.6508508392, 4697949.525384568], [289131.7085413809, 4697951.214087553], [289134.0561435851, 4697952.468907074], [289136.60344041564, 4697953.24162112], [289139.25254068384, 4697953.502534723], [289141.90164095204, 4697953.24162112], [289144.44893778255, 4697952.468907074], [289146.7965399868, 4697951.214087553], [289148.85423052846, 4697949.525384568], [289150.54293351417, 4697947.467694026], [289151.7977530351, 4697945.120091822], [289152.5704670808, 4697942.572794992], [289152.8313806838, 4697939.923694723]]]}
            }
        ]
    features[0]["geometry"] = geometry
    query_dict = {"f": "json",
                    "token": token,
                    "features": features
                    }

    jsonResponse = urllib.request.urlopen("https://services6.arcgis.com/QUg4M9ZDNdUHdQcy/arcgis/rest/services/web_app_test_peaks/FeatureServer/2" + r"/addFeatures", urllib.parse.urlencode(query_dict).encode('utf-8'))  
    jsonOutput = json.loads(jsonResponse.read(),
                            object_pairs_hook=collections.OrderedDict)

    print(jsonOutput)
geometry = {'rings': [[[289298.73922971566, 4697769.398504356], [289298.68449210736, 4697769.375831296], [289294.8022064308, 4697768.8647186905], [289294.416318118, 4697768.915521851], [289294.17426071194, 4697768.883654389], [289293.4025340111, 4697768.985254136], [289292.9184515729, 4697768.921523474], [289289.03616589634, 4697769.432636079], [289285.4184515729, 4697770.931142418], [289284.88693124644, 4697771.338992309], [289284.8033599168, 4697771.373608687], [289284.4226564211, 4697771.665732753], [289282.94523792795, 4697772.277699531], [289282.4133982324, 4697772.685794483], [289282.33014988876, 4697772.720277076], [289281.5694618443, 4697773.303973542], [289278.613818669, 4697774.528241031], [289277.70158483146, 4697775.228222674], [289276.14060750935, 4697775.874800651], [289275.7599841599, 4697776.16686322], [289275.5926909511, 4697776.236158336], [289275.5417720302, 4697776.2294547325], [289274.770083598, 4697776.331049442], [289274.28604638926, 4697776.2673247345], [289270.4037607127, 4697776.77843734], [289266.78604638926, 4697778.276943678], [289263.67944467143, 4697780.660723017], [289262.9806435063, 4697781.571418426], [289262.461962316, 4697781.969416501], [289260.07818297704, 4697785.076018219], [289259.93206541566, 4697785.428777217], [289258.8734774765, 4697786.808355879], [289257.37497113895, 4697790.426070202], [289257.22459704283, 4697791.568274861], [289257.2132704475, 4697791.572966491], [289257.0244253973, 4697791.597828413], [289253.4067110738, 4697793.096334752], [289253.02629009774, 4697793.388242033], [289251.548595268, 4697794.000323273], [289249.4216813387, 4697795.632361732], [289249.0880909901, 4697795.770539379], [289247.49293775135, 4697796.994543509], [289247.24275389983, 4697797.098173053], [289246.7108996668, 4697797.506279159], [289246.62767024036, 4697797.540753917], [289243.52106852253, 4697799.924533255], [289243.21058442356, 4697800.329164011], [289241.5826052375, 4697800.543491537], [289240.52880441485, 4697800.979990129], [289240.3395761851, 4697801.004902499], [289236.72186186165, 4697802.503408837], [289233.6152601438, 4697804.887188176], [289231.23148080485, 4697807.993789894], [289230.76210687077, 4697809.126958811], [289230.64195129316, 4697809.283548608], [289229.14344495564, 4697812.9012629315], [289228.66829036555, 4697816.510420363], [289225.8670188475, 4697817.670745019], [289225.33547363814, 4697818.078614003], [289225.2519349966, 4697818.113216842], [289224.7201606378, 4697818.5212616585], [289224.63677227276, 4697818.55580225], [289224.1049081597, 4697818.9639159385], [289224.02169192303, 4697818.998385232], [289222.95837084885, 4697819.814300189], [289222.7914458093, 4697819.883442804], [289222.25958093273, 4697820.291557078], [289222.1763656923, 4697820.326025959], [289221.64459007315, 4697820.734071743], [289221.56120335264, 4697820.768611654], [289221.02965638496, 4697821.176481987], [289220.9461200384, 4697821.211083875], [289220.4142544088, 4697821.6191987265], [289220.3310401519, 4697821.6536672], [289219.2677160508, 4697822.46958448], [289219.10079495923, 4697822.53872546], [289218.7200143233, 4697822.8309087185], [289217.2426945032, 4697823.442834624], [289216.7112353234, 4697823.850637596], [289216.6275293895, 4697823.885309729], [289215.03201610077, 4697825.109590135], [289214.78220915544, 4697825.2130635595], [289214.25065945915, 4697825.620935987], [289214.1671266474, 4697825.65553641], [289214.0012160716, 4697825.782844073], [289212.1848996491, 4697826.021966666], [289208.56718532566, 4697827.520473004], [289208.0353149359, 4697827.928591508], [289207.95210674056, 4697827.963057471], [289204.84550502273, 4697830.34683681], [289202.46172568377, 4697833.453438528], [289202.3887476967, 4697833.6296229735], [289201.8593415667, 4697834.319558475], [289201.3899558104, 4697835.452755934], [289201.26981998514, 4697835.60931999], [289199.7713136476, 4697839.227034313], [289199.26020104194, 4697843.10931999], [289199.7713136476, 4697846.9916056665], [289201.26981998514, 4697850.60931999], [289203.6535993241, 4697853.715921707], [289203.69689877867, 4697853.749146547], [289204.3070177668, 4697854.544269093], [289207.41361948464, 4697856.928048432], [289211.0313338081, 4697858.42655477], [289211.52613561903, 4697858.491696664], [289212.2999092846, 4697858.812204211], [289213.78174639295, 4697859.007291767], [289214.1963461593, 4697859.179024613], [289215.67831056466, 4697859.374128928], [289216.09286510246, 4697859.545843041], [289217.57508602826, 4697859.740981127], [289217.98929816455, 4697859.912553412], [289218.48370642954, 4697859.9776434945], [289219.2578762629, 4697860.2983151395], [289219.7521540725, 4697860.363388048], [289220.52637191006, 4697860.684079576], [289224.4086575866, 4697861.1951921815], [289224.4445329539, 4697861.1904691], [289224.9471801915, 4697861.398672403], [289226.4290030236, 4697861.593758079], [289226.84361548926, 4697861.765496186], [289230.7259011658, 4697862.276608791], [289231.0527290481, 4697862.233581084], [289232.4656015029, 4697862.419589272], [289232.5202201876, 4697862.4422130715], [289233.50888375106, 4697862.572373099], [289235.05729109154, 4697863.21374442], [289237.5270364532, 4697863.538892564], [289237.58166187746, 4697863.561519156], [289239.06347058644, 4697863.756602974], [289239.4780957117, 4697863.928346324], [289239.97248726006, 4697863.993434206], [289240.74667166104, 4697864.314111885], [289244.6289573376, 4697864.82522449], [289245.4007128711, 4697864.7236209465], [289245.8847549432, 4697864.787346294], [289245.9205346893, 4697864.7826358015], [289246.42318992666, 4697864.990842418], [289246.9175761326, 4697865.055929597], [289247.6917652242, 4697865.376609218], [289249.1735626003, 4697865.571691544], [289249.58819786366, 4697865.743439093], [289252.05792197556, 4697866.06858444], [289252.1125666797, 4697866.091219018], [289252.60694845475, 4697866.156305614], [289253.3811414032, 4697866.476986833], [289254.8629323816, 4697866.672068316], [289255.27757335006, 4697866.843818229], [289259.1598590266, 4697867.354930834], [289259.54570654687, 4697867.304133045], [289259.78771640465, 4697867.335994246], [289260.1736142889, 4697867.285189826], [289260.4156560827, 4697867.317055233], [289260.7428514267, 4697867.273979149], [289262.15478767, 4697867.459864081], [289262.2098843002, 4697867.482685853], [289263.6917950228, 4697867.677783101], [289264.1063976578, 4697867.849517135], [289266.08293599245, 4697868.109733343], [289267.27139855304, 4697868.602010654], [289267.76563918835, 4697868.667078668], [289268.5398895177, 4697868.9877836555], [289271.50395304366, 4697869.3780100215], [289272.3328286656, 4697869.721341546], [289274.3089630718, 4697869.981504575], [289275.49783095275, 4697870.473949776], [289279.3801166293, 4697870.985062381], [289279.41585147067, 4697870.9803578], [289279.9185429416, 4697871.188579425], [289282.3878345267, 4697871.513667829], [289282.4429109379, 4697871.536481226], [289286.32519661443, 4697872.047593831], [289286.36098924006, 4697872.0428816425], [289286.86370356486, 4697872.251112734], [289288.34545711015, 4697872.446189289], [289288.76013162395, 4697872.6179530965], [289289.25487307424, 4697872.683087044], [289290.02869939, 4697873.003616399], [289293.91098506656, 4697873.514729004], [289294.62353521807, 4697873.420919998], [289297.6910650176, 4697873.8247679565], [289298.46278356516, 4697873.723169282], [289298.9468606585, 4697873.786899241], [289299.33269432106, 4697873.736103276], [289299.57471733, 4697873.767966209], [289300.34643458604, 4697873.666367705], [289300.83051297, 4697873.730097833], [289301.60222936526, 4697873.628499443], [289302.0863086074, 4697873.6922296835], [289302.85802415025, 4697873.590631405], [289303.34210424474, 4697873.654361758], [289303.72793640225, 4697873.603565991], [289303.9699609127, 4697873.6354291225], [289304.74167516286, 4697873.533831014], [289305.2257565467, 4697873.597561537], [289305.99746993725, 4697873.495963542], [289306.48155218054, 4697873.559694178], [289306.8673832655, 4697873.5088985525], [289307.1094088468, 4697873.540761825], [289307.8811209489, 4697873.439163999], [289308.3652044786, 4697873.502894805], [289308.69189512066, 4697873.459885166], [289311.51742665115, 4697873.831873449], [289312.2891357097, 4697873.730276024], [289312.77322220185, 4697873.794007219], [289313.099905104, 4697873.750998599], [289315.9254439059, 4697874.122987839], [289316.3112717355, 4697874.072192642], [289316.5533004919, 4697874.104056332], [289317.3250060745, 4697874.002459365], [289317.80909595976, 4697874.066191007], [289318.5807501176, 4697873.964600811], [289319.0648091283, 4697874.028328388], [289319.8365129906, 4697873.926731647], [289320.3206045935, 4697873.990463516], [289320.7064814975, 4697873.939661858], [289320.9485434751, 4697873.9715299215], [289321.7201954772, 4697873.869940008], [289322.20425664017, 4697873.933667869], [289322.9759583614, 4697873.8320714105], [289323.4600521031, 4697873.8958035605], [289323.8459279238, 4697873.845002045], [289324.0879909828, 4697873.876870251], [289324.8596408433, 4697873.77528062], [289325.3437041446, 4697873.8390087625], [289325.7295793247, 4697873.788207332], [289325.97164302354, 4697873.820075622], [289326.7433421677, 4697873.718479502], [289327.22743848216, 4697873.782211991], [289327.99908619036, 4697873.680622643], [289328.48315164045, 4697873.7443510685], [289329.25484906376, 4697873.642755175], [289329.7389470954, 4697873.70648789], [289330.5106436585, 4697873.60489211], [289330.994742549, 4697873.668624938], [289331.38056522456, 4697873.61783042], [289331.62259912665, 4697873.649694787], [289335.5048848032, 4697873.138582182], [289335.6568054741, 4697873.07565458], [289337.3064176214, 4697872.858479021], [289338.51666033466, 4697873.0178104965], [289339.22911748476, 4697872.924013733], [289342.2967369785, 4697873.327873501], [289342.6237885376, 4697873.284816346], [289345.4489532727, 4697873.65675634], [289345.8347709871, 4697873.605962474], [289346.07680980355, 4697873.637827489], [289346.84849516425, 4697873.536233184], [289347.33260516403, 4697873.599967474], [289348.1042896676, 4697873.498373282], [289348.58840052225, 4697873.562107685], [289349.36008416314, 4697873.460513607], [289349.84419588116, 4697873.524248123], [289350.23001209105, 4697873.473454456], [289350.4720524095, 4697873.505319668], [289351.2437347644, 4697873.403725759], [289351.72784776427, 4697873.467460444], [289352.499529263, 4697873.365866648], [289352.9836431187, 4697873.429601446], [289353.3102559413, 4697873.386602052], [289356.135861894, 4697873.758600133], [289356.9075403487, 4697873.657006737], [289357.3916571663, 4697873.720741925], [289358.1632841862, 4697873.619155301], [289358.6473701404, 4697873.682886425], [289359.03323390166, 4697873.632086498], [289359.27530892484, 4697873.663956279], [289360.0469852274, 4697873.562363166], [289360.53110419377, 4697873.6260986375], [289361.302729068, 4697873.524512296], [289361.78681716335, 4697873.588243702], [289362.55849174905, 4697873.486650816], [289363.0426124296, 4697873.550386513], [289363.4284746869, 4697873.499586782], [289363.6705512127, 4697873.531456762], [289364.4421739341, 4697873.429870703], [289364.9262641778, 4697873.493602393], [289365.6979366112, 4697873.39200979], [289366.1820594405, 4697873.45574577], [289366.95373102545, 4697873.354153278], [289367.43785470404, 4697873.41788937], [289368.2095254207, 4697873.316296993], [289368.6936499641, 4697873.380033198], [289369.0794597159, 4697873.329240381], [289369.321506444, 4697873.361106437], [289370.0931758727, 4697873.259514229], [289370.57730170316, 4697873.323250604], [289371.34897027456, 4697873.221658509], [289371.8330969596, 4697873.285394996], [289372.2189056389, 4697873.23460232], [289372.46095343796, 4697873.2664685175], [289373.2326207179, 4697873.164876593], [289373.7167486936, 4697873.22861325], [289374.4884151199, 4697873.1270214375], [289374.97254394676, 4697873.190758207], [289375.35835155094, 4697873.139965672], [289375.6004004254, 4697873.171832011], [289376.31278015306, 4697873.078045441], [289379.3804740133, 4697873.481914999], [289379.76633066515, 4697873.431116007], [289380.0084127484, 4697873.462986718], [289380.7800748397, 4697873.361395476], [289381.2642079196, 4697873.4251328055], [289382.03581858147, 4697873.323548335], [289382.5199207893, 4697873.387281599], [289382.9057763685, 4697873.336482748], [289383.1478595226, 4697873.368353601], [289383.91951946926, 4697873.266762641], [289384.4036546914, 4697873.330500253], [289385.1752632017, 4697873.228916065], [289385.6593675589, 4697873.292649613], [289386.4310257876, 4697873.19105888], [289386.91516272275, 4697873.254796716], [289387.3009662289, 4697873.204004722], [289387.54301915463, 4697873.2358715935], [289388.31467609195, 4697873.134281031], [289388.7988143177, 4697873.198019037], [289389.5704703977, 4697873.096428587], [289390.05460947816, 4697873.160166706], [289390.8262646956, 4697873.05857637], [289391.3104046395, 4697873.122314602], [289391.6373707415, 4697873.079268699], [289394.4626172583, 4697873.451219458], [289394.8484181684, 4697873.400427805], [289395.09047364804, 4697873.432295013], [289395.86212539667, 4697873.330705133], [289396.3462687266, 4697873.394443812], [289397.11791961093, 4697873.2928540455], [289397.60206380265, 4697873.356592838], [289397.9878636402, 4697873.3058013255], [289398.2299201907, 4697873.337668675], [289399.00156979065, 4697873.236079078], [289399.4857152658, 4697873.299818039], [289400.257364002, 4697873.198228556], [289400.7415103395, 4697873.26196763], [289401.0680398986, 4697873.2189791985], [289403.89372551837, 4697873.590987767], [289405.8228128673, 4697873.3370186], [289407.03317184746, 4697873.496365382], [289407.8048153945, 4697873.394776582], [289408.2889668357, 4697873.458516329], [289409.0012782744, 4697873.364738748], [289412.0690376522, 4697873.768616932], [289412.840677728, 4697873.667028589], [289413.3248325598, 4697873.730768782], [289414.09642120614, 4697873.6291872095], [289414.58054516587, 4697873.692923338], [289415.3521835213, 4697873.591335221], [289415.83634007076, 4697873.65507564], [289416.60797756945, 4697873.553487636], [289417.0921349741, 4697873.617228168], [289417.4779281114, 4697873.566437538], [289417.7199912752, 4697873.598305758], [289418.49162749253, 4697873.496717923], [289418.9757861766, 4697873.560458623], [289419.7474215262, 4697873.458870902], [289420.2315810757, 4697873.522611716], [289421.0032155656, 4697873.421024108], [289421.4873759744, 4697873.484765035], [289421.87316761434, 4697873.433974602], [289422.1152322731, 4697873.465843019], [289422.88686547393, 4697873.364255581], [289423.3710271687, 4697873.427996677], [289424.1426595134, 4697873.326409352], [289424.62682206393, 4697873.390150561], [289425.0126126319, 4697873.339360269], [289425.2546783621, 4697873.371228827], [289426.0263094142, 4697873.269641672], [289426.5104732542, 4697873.333383051], [289427.28210345027, 4697873.231796009], [289427.7662681461, 4697873.2955375], [289428.53789747786, 4697873.193950571], [289429.0220630355, 4697873.257692176], [289429.40785210195, 4697873.206902082], [289429.64991933014, 4697873.238770837], [289430.4215473739, 4697873.137184078], [289430.9057142185, 4697873.200925852], [289431.6773414122, 4697873.099339205], [289432.1615091046, 4697873.163081091], [289432.8741908513, 4697873.069254759], [289435.94157482113, 4697873.473083519], [289436.32736150036, 4697873.422293739], [289436.56943107385, 4697873.4541628035], [289437.34105435736, 4697873.352576671], [289437.8252258786, 4697873.416319061], [289438.2110119171, 4697873.365529366], [289438.4530821303, 4697873.397398514], [289439.22470413183, 4697873.29581255], [289439.7088769319, 4697873.3595551085], [289440.0353385116, 4697873.316575626], [289442.86108907417, 4697873.688592745], [289443.63270802866, 4697873.587007183], [289444.11688379466, 4697873.650750131], [289444.5026676654, 4697873.599960721], [289444.7447400049, 4697873.631830149], [289445.51635766786, 4697873.5302447565], [289446.0005347244, 4697873.593987876], [289446.77215153375, 4697873.4924025955], [289447.25632944156, 4697873.556145826], [289447.6421122403, 4697873.505356558], [289447.88418565114, 4697873.5372261265], [289448.65580117196, 4697873.435641016], [289449.1399803662, 4697873.499384416], [289449.9115950233, 4697873.397799419], [289450.39577507984, 4697873.461542933], [289451.1673888778, 4697873.35995805], [289451.6515697942, 4697873.423701677], [289452.4231827381, 4697873.322116906], [289452.9073645052, 4697873.385860644], [289453.6789260172, 4697873.284282644], [289454.16307691694, 4697873.348022319], [289454.54890791915, 4697873.297226705], [289454.7910154207, 4697873.329100762], [289455.5625756441, 4697873.227522931], [289456.04672783025, 4697873.291262776], [289456.8183377687, 4697873.1896784], [289457.3025225365, 4697873.253422534], [289458.0741316087, 4697873.151838273], [289458.5583172433, 4697873.215582521], [289458.9440961795, 4697873.1647937605], [289459.1861734457, 4697873.196663837], [289459.95778123196, 4697873.095079745], [289460.4419681485, 4697873.158824162], [289461.21357507503, 4697873.0572401825], [289461.69776285085, 4697873.120984713], [289462.0241861201, 4697873.078010274], [289464.8499734072, 4697873.450032228], [289465.62157728977, 4697873.348448649], [289466.1057680275, 4697873.412193569], [289466.87737105443, 4697873.310610103], [289467.3615626485, 4697873.374355136], [289468.13311424566, 4697873.272778442], [289468.61727496726, 4697873.33651941], [289472.4995606438, 4697872.825406805], [289472.6512169081, 4697872.762588724], [289472.75766852073, 4697872.748574102], [289472.99975050916, 4697872.780444801], [289473.77134884754, 4697872.678861952], [289474.25554519694, 4697872.742607611], [289475.027142675, 4697872.641024876], [289475.5113398832, 4697872.704770648], [289476.2829365022, 4697872.603188026], [289476.7671345703, 4697872.666933911], [289477.53867975937, 4697872.5653580595], [289478.0228469549, 4697872.62909988], [289478.79444185656, 4697872.5275174845], [289479.27864163823, 4697872.591263595], [289480.0502356792, 4697872.489681313], [289480.53443631914, 4697872.553427536], [289480.9202077331, 4697872.502639766], [289481.16229250946, 4697872.534510831], [289481.9338852624, 4697872.432928719], [289482.4180871893, 4697872.496675111], [289483.18967907806, 4697872.395093112], [289483.67388186685, 4697872.458839619], [289484.44547290704, 4697872.357257731], [289484.9296765451, 4697872.421004349], [289485.7012161553, 4697872.319429233], [289486.18538892077, 4697872.383171787], [289486.9569782365, 4697872.281590126], [289487.4411835952, 4697872.345336971], [289488.2127720467, 4697872.243755424], [289488.69697826717, 4697872.307502382], [289489.4091221155, 4697872.213746866], [289492.08056329493, 4697872.565448769], [289493.36385049886, 4697874.237861214], [289496.4704522167, 4697876.621640553], [289500.08816654014, 4697878.120146891], [289503.9704522167, 4697878.631259496], [289507.85273789323, 4697878.120146891], [289511.4704522167, 4697876.621640553], [289512.0018242835, 4697876.2139044255], [289512.08563085936, 4697876.179190605], [289515.1922325772, 4697873.795411266], [289515.8360207944, 4697872.956410127], [289517.0248352278, 4697872.044200729], [289517.72351905605, 4697871.133658236], [289518.24234526657, 4697870.735548883], [289519.5848107497, 4697868.986013803], [289521.2924606639, 4697867.675687938], [289523.67624000285, 4697864.56908622], [289525.1747463404, 4697860.951371897], [289525.68585894606, 4697857.06908622], [289525.65159097075, 4697856.808795106], [289525.673096772, 4697856.6454423275], [289525.6388287972, 4697856.385151217], [289525.660334599, 4697856.221798435], [289525.1492219933, 4697852.339512758], [289523.65071565576, 4697848.721798435], [289521.2669363168, 4697845.615196717], [289518.7913023961, 4697843.715575998], [289518.96031294344, 4697842.4318134375], [289518.92605377664, 4697842.17158923], [289518.9475537662, 4697842.008280597], [289518.84475830395, 4697841.227471542], [289518.9092695496, 4697840.737459982], [289518.3981569439, 4697836.855174305], [289516.8996506064, 4697833.237459982], [289514.5158712674, 4697830.130858264], [289514.4725019807, 4697830.09757984], [289513.8624062291, 4697829.302487576], [289513.81904216326, 4697829.269213159], [289513.2090266862, 4697828.474225511], [289510.1024249684, 4697826.090446172], [289509.8565091935, 4697825.988584523], [289509.4618045584, 4697825.685717004], [289507.9208015208, 4697825.047412646], [289507.43044049124, 4697824.408361711], [289507.3868676896, 4697824.374927124], [289506.77697744826, 4697823.580102687], [289506.7338080201, 4697823.54697762], [289506.12359321007, 4697822.751730196], [289505.27735674975, 4697822.102390122], [289504.8295084036, 4697821.518742794], [289503.98327042634, 4697820.869401556], [289503.5354231456, 4697820.285755617], [289503.49205247883, 4697820.252476133], [289502.8820415801, 4697819.457494453], [289502.8386647559, 4697819.424210245], [289502.2285742205, 4697818.629124779], [289499.1219725027, 4697816.245345441], [289498.6298212876, 4697816.041489732], [289497.84073186, 4697815.436000119], [289497.64639428747, 4697815.355502861], [289497.96165392693, 4697812.960868157], [289497.9273852017, 4697812.700571346], [289497.9488902511, 4697812.537224279], [289497.8803617845, 4697812.016698897], [289497.92336624756, 4697811.69004757], [289497.4122536419, 4697807.807761893], [289495.91374730435, 4697804.19004757], [289493.5299679654, 4697801.083445852], [289493.486787939, 4697801.050312652], [289492.87658023596, 4697800.255074491], [289492.83299589204, 4697800.221631047], [289492.2231134057, 4697799.426816717], [289489.68454334873, 4697797.478903402], [289488.3409203488, 4697795.7278598165], [289488.29773684277, 4697795.694723947], [289487.7273761498, 4697794.9514154205], [289487.4448354307, 4697794.269301784], [289485.06105609174, 4697791.162700066], [289485.0176710771, 4697791.129409574], [289484.4076698426, 4697790.334440487], [289484.3642786765, 4697790.301145275], [289483.75419780106, 4697789.506072398], [289483.7108118525, 4697789.472781189], [289483.10081125575, 4697788.677812934], [289481.5121492028, 4697787.458789666], [289481.9988196977, 4697783.762160253], [289481.96455054835, 4697783.501860221], [289481.9860551724, 4697783.338516384], [289481.4749425667, 4697779.4562307075], [289479.9764362292, 4697775.838516384], [289477.5926568902, 4697772.7319146665], [289477.549060017, 4697772.698461609], [289476.93918590614, 4697771.903658194], [289473.8325841883, 4697769.519878855], [289473.5866440707, 4697769.418007122], [289473.1919566069, 4697769.11515278], [289472.1346987845, 4697768.677222251], [289471.8011614138, 4697768.242547886], [289470.9548760609, 4697767.5931702955], [289470.5070610051, 4697767.009566353], [289470.46386353904, 4697766.976419771], [289469.85366762505, 4697766.181196974], [289466.7470659072, 4697763.797417635], [289466.657761112, 4697763.760426378], [289466.6376011816, 4697763.734153445], [289466.59420217894, 4697763.700852219], [289465.984210396, 4697762.90589545], [289465.1379183112, 4697762.256512694], [289464.69010799733, 4697761.672914931], [289464.646701994, 4697761.639608333], [289464.03663115663, 4697760.844548538], [289463.9932303741, 4697760.811245946], [289463.3832398121, 4697760.016290769], [289463.3400376413, 4697759.983140578], [289462.72984497336, 4697759.18792201], [289461.88354882924, 4697758.538536139], [289461.43574133853, 4697757.954942055], [289458.3291396207, 4697755.5711627165], [289454.71142529725, 4697754.072656378], [289450.8291396207, 4697753.561543773], [289450.4433549015, 4697753.612333295], [289450.2012753328, 4697753.580462915], [289449.8154398325, 4697753.631259122], [289449.57332874555, 4697753.599384593], [289446.48688983195, 4697754.005721984], [289445.96294963866, 4697753.93674395], [289445.90806881315, 4697753.914011567], [289442.0257831366, 4697753.402898962], [289441.254207431, 4697753.50447883], [289440.7700544768, 4697753.440738885], [289440.38421573973, 4697753.491535518], [289440.1421078463, 4697753.459661409], [289439.3704802824, 4697753.561248105], [289438.8862968832, 4697753.497504151], [289438.1147190314, 4697753.599084303], [289437.63056821784, 4697753.535344639], [289436.85893893766, 4697753.636931561], [289436.3747572531, 4697753.573187833], [289435.98891700804, 4697753.623984665], [289435.7468106202, 4697753.592110754], [289434.97523062374, 4697753.693691188], [289434.49108195247, 4697753.629951806], [289433.71945052355, 4697753.731539011], [289433.23527098424, 4697753.667795565], [289432.4636387018, 4697753.769382882], [289431.97946001386, 4697753.705639549], [289431.59366883, 4697753.756429922], [289431.3515956786, 4697753.7245603865], [289430.5799621075, 4697753.826147873], [289430.09578470595, 4697753.762404709], [289429.3241502712, 4697753.863992309], [289428.839973732, 4697753.800249259], [289428.06833843753, 4697753.901836973], [289427.5841627576, 4697753.838094035], [289427.25765988545, 4697753.881078954], [289424.4319094209, 4697753.509061848], [289423.66032165516, 4697753.610643304], [289423.1761806645, 4697753.546904934], [289422.4045414659, 4697753.648493161], [289421.9203696068, 4697753.584750727], [289421.1487295551, 4697753.686339066], [289420.66455854767, 4697753.622596744], [289419.8929176363, 4697753.724185198], [289419.4087474883, 4697753.660442988], [289418.6371057126, 4697753.762031555], [289418.15293642634, 4697753.69828946], [289414.2706507498, 4697754.209402065], [289414.0675981117, 4697754.293509222], [289413.7704888429, 4697754.254394044], [289413.3846408633, 4697754.305191894], [289413.1425421978, 4697754.273319], [289412.3708961664, 4697754.374908128], [289411.88673120533, 4697754.311166601], [289411.17440188513, 4697754.404946535], [289408.10661248665, 4697754.001064399], [289407.7208131279, 4697754.051855848], [289407.4787481002, 4697754.019987383], [289403.5964624237, 4697754.531099988], [289403.2191126975, 4697754.687403362], [289403.19457672315, 4697754.690633585], [289402.4683544722, 4697754.595024612], [289402.1418079202, 4697754.6380152805], [289399.31609954213, 4697754.266003716], [289398.54444402474, 4697754.367594092], [289398.0602884584, 4697754.303853802], [289397.28863208083, 4697754.405444291], [289396.8044773733, 4697754.341704115], [289396.03282013553, 4697754.443294718], [289395.54866628675, 4697754.3795546545], [289395.16286262707, 4697754.43034667], [289394.9208018936, 4697754.39847877], [289394.14914337144, 4697754.500069541], [289393.66499080625, 4697754.436329647], [289392.8933314233, 4697754.537920532], [289392.40917971625, 4697754.474180751], [289392.02337498753, 4697754.524972906], [289391.7813153214, 4697754.493105147], [289391.00965464994, 4697754.594696201], [289390.5255042294, 4697754.53095659], [289389.75384269835, 4697754.632547758], [289389.2696931372, 4697754.5688082585], [289385.38740746066, 4697755.079920864], [289385.18429747276, 4697755.164051776], [289384.8871648963, 4697755.12493353], [289383.40311140753, 4697755.320312878], [289379.85123334546, 4697754.85269926], [289379.0796150879, 4697754.954284731], [289378.59550454165, 4697754.890550368], [289377.8238348471, 4697754.992142611], [289377.33969343535, 4697754.928404185], [289376.5680228811, 4697755.02999654], [289376.0838823287, 4697754.966258228], [289375.3122109173, 4697755.067850696], [289374.8280712197, 4697755.004112496], [289370.9457855431, 4697755.515225101], [289370.7426590796, 4697755.599362837], [289370.44554380164, 4697755.560246869], [289369.67391913204, 4697755.661833184], [289369.1898150628, 4697755.598099674], [289368.8039518334, 4697755.648899532], [289368.5618683933, 4697755.617028642], [289367.8494489035, 4697755.710820448], [289364.78174690244, 4697755.306949818], [289362.0808914294, 4697755.662524186], [289360.3864491223, 4697755.439446624], [289359.61476697144, 4697755.541040507], [289359.1306379972, 4697755.477303718], [289358.74482188775, 4697755.5280973725], [289358.5027735841, 4697755.496231109], [289357.7310901443, 4697755.597825161], [289357.24696245603, 4697755.534088542], [289356.47527816, 4697755.635682707], [289355.99115132744, 4697755.5719462], [289355.2195167394, 4697755.673533821], [289354.7354224955, 4697755.609801604], [289354.3495543089, 4697755.660602115], [289354.10747578, 4697755.628731872], [289353.33578933537, 4697755.73032632], [289352.85166464816, 4697755.6665900955], [289352.52503172966, 4697755.709592135], [289349.6994063814, 4697755.337591501], [289348.9277674649, 4697755.4391796915], [289348.44367746636, 4697755.375448034], [289348.0578071125, 4697755.42624883], [289347.81573071034, 4697755.394378867], [289347.04403993726, 4697755.495973884], [289346.55991949537, 4697755.432238219], [289345.7882784267, 4697755.533826693], [289345.304190577, 4697755.470095319], [289344.9183191501, 4697755.520896256], [289344.67624381825, 4697755.489026434], [289344.2904227511, 4697755.539820741], [289344.04837935814, 4697755.507955124], [289340.5757777813, 4697755.965131794], [289338.3972700081, 4697755.678325805], [289338.0701918174, 4697755.721386465], [289336.6581636161, 4697755.535489426], [289336.6029867404, 4697755.512634416], [289332.72070106387, 4697755.001521811], [289328.8384153873, 4697755.512634416], [289328.66377334023, 4697755.584973521], [289325.81377958227, 4697755.209764725], [289325.42795203446, 4697755.260559885], [289325.18591503566, 4697755.2286951095], [289324.80008727603, 4697755.279490298], [289324.55805048987, 4697755.24762555], [289323.78634374595, 4697755.34922267], [289323.30223909597, 4697755.285489084], [289322.9163601158, 4697755.336291016], [289322.674292249, 4697755.304422176], [289322.2884636251, 4697755.355217478], [289322.0464277008, 4697755.323352844], [289321.660598865, 4697755.374148174], [289321.41856315325, 4697755.342283568], [289321.0326835288, 4697755.393085585], [289320.7906163052, 4697755.36121683], [289320.01890698075, 4697755.46281429], [289319.5348049072, 4697755.399081043], [289319.1489752148, 4697755.449876485], [289318.90694035834, 4697755.418011992], [289318.13522974536, 4697755.519609622], [289317.6511289583, 4697755.455876544], [289317.2652986216, 4697755.506672071], [289317.02326440834, 4697755.474807663], [289313.1409787318, 4697755.985920268], [289312.5379437795, 4697756.235705524], [289310.6421296404, 4697756.48529419], [289307.02441531693, 4697757.983800529], [289303.9178135991, 4697760.367579867], [289301.53403426014, 4697763.474181585], [289300.0355279226, 4697767.091895908], [289299.71494567965, 4697769.526959799], [289298.73922971566, 4697769.398504356]], [[289301.426976528, 4698069.757312419], [289301.343784797, 4698069.791771562], [289298.2371830792, 4698072.1755509], [289295.8534037402, 4698075.282152618], [289294.3548974027, 4698078.899866941], [289293.843784797, 4698082.782152618], [289294.3548974027, 4698086.664438295], [289295.8534037402, 4698090.282152618], [289298.2371830792, 4698093.388754336], [289301.343784797, 4698095.772533675], [289304.96149912046, 4698097.271040013], [289308.843784797, 4698097.782152618], [289312.72607047355, 4698097.271040013], [289316.343784797, 4698095.772533675], [289316.8756542894, 4698095.364415859], [289316.9588460204, 4698095.329956716], [289317.7197024658, 4698094.746131032], [289320.6750186537, 4698093.521998985], [289321.9681414645, 4698092.529750953], [289325.0061695407, 4698091.271358521], [289328.1127712585, 4698088.887579182], [289330.4965505975, 4698085.780977464], [289331.995056935, 4698082.163263141], [289332.5061695407, 4698078.280977464], [289331.995056935, 4698074.398691787], [289331.59731677873, 4698073.438462107], [289331.8979823258, 4698073.563001855], [289335.78026800236, 4698074.0741144605], [289339.6625536789, 4698073.563001855], [289343.28026800236, 4698072.064495517], [289346.3868697202, 4698069.680716178], [289348.77064905915, 4698066.5741144605], [289349.45915450266, 4698064.911915281], [289351.1672169836, 4698062.685924917], [289352.66572332114, 4698059.068210594], [289353.17683592683, 4698055.185924917], [289352.66572332114, 4698051.303639241], [289351.1672169836, 4698047.685924917], [289348.78343764466, 4698044.5793232], [289345.67683592683, 4698042.195543861], [289342.0591216034, 4698040.697037523], [289338.17683592683, 4698040.185924917], [289334.2945502503, 4698040.697037523], [289330.67683592683, 4698042.195543861], [289327.570234209, 4698044.5793232], [289325.18645487004, 4698047.685924917], [289324.4979494265, 4698049.348124097], [289322.78988694557, 4698051.5741144605], [289321.29138060805, 4698055.191828784], [289320.78026800236, 4698059.0741144605], [289321.29138060805, 4698062.956400137], [289321.6891207643, 4698063.916629817], [289321.38845521724, 4698063.7920900695], [289317.5061695407, 4698063.280977464], [289313.62388386414, 4698063.7920900695], [289310.0061695407, 4698065.290596408], [289308.71304672986, 4698066.282844439], [289305.6750186537, 4698067.541236872], [289304.91416220827, 4698068.125062556], [289301.9588460204, 4698069.349194603], [289301.426976528, 4698069.757312419]], [[289273.4080478519, 4698098.2951274235], [289272.8969352462, 4698094.412841747], [289271.39842890867, 4698090.7951274235], [289269.0146495697, 4698087.688525706], [289265.9080478519, 4698085.304746367], [289262.2903335284, 4698083.806240029], [289258.4080478519, 4698083.2951274235], [289254.5257621753, 4698083.806240029], [289250.9080478519, 4698085.304746367], [289247.80144613405, 4698087.688525706], [289245.4176667951, 4698090.7951274235], [289243.91916045756, 4698094.412841747], [289243.4080478519, 4698098.2951274235], [289243.91916045756, 4698102.1774131], [289245.4176667951, 4698105.7951274235], [289247.80144613405, 4698108.901729141], [289250.9080478519, 4698111.28550848], [289254.5257621753, 4698112.784014818], [289258.4080478519, 4698113.2951274235], [289262.2903335284, 4698112.784014818], [289265.9080478519, 4698111.28550848], [289269.0146495697, 4698108.901729141], [289271.39842890867, 4698105.7951274235], [289272.8969352462, 4698102.1774131], [289273.4080478519, 4698098.2951274235]]]}
token = get_token("hangchen_sniffergis", "Ch970721")
add_feature(token, geometry)

# print(geometry)




# start = time.time()
# file = open("/Users/apple/Desktop/python/internship/web_vue/web_viewer_back/data/inficon/92003059_20220718_1935_IRW0081.csv")
# while file.readline() != '\n':
#     pass
# csvDf = pd.read_csv(file)
# file.close()
# # print(csvDf)
# df = cp.cleanInficon("-buffer", csvDf)
# print(df)
# print(df['Microsec'].duplicated().any())

# gt.add_points_to_df(df, "Long", "Lat")
# points = gt.series_to_multipoint(df["points"])
# sr = gt.find_utm_zone(points[0].y, points[0].x)
# points = gt.reproject(points, sr)
# print(app.createBuff(points, 15, sr))




# start = time.time()
# csvDf = pd.read_csv("/Users/apple/Desktop/python/internship/web_vue/web_viewer_back/data/snifferdrone/N1_15_2.8_20220620_153056.csv")
# cleanedDf = cp.clean_flight_log("-buffer", csvDf)
# # print(cleanedDf)
# # # # end = time.time()
# # # # print(end-start)

# add a column of points
# gt.add_points_to_df(cleanedDf)
# points = gt.series_to_multipoint(cleanedDf["points"])
# # pre project the points to prepare for buffer.
# sr = gt.find_utm_zone(points[0].y, points[0].x)
# points = gt.reproject(points, sr)


# cleanedDf["UtmLong"] = [i.x for i in points]
# cleanedDf["UtmLat"] = [i.y for i in points]
# print(cleanedDf)

# buff = points.buffer(15, resolution=8)
# geo_j = mapping(buff)
# with open("test.json", "w") as file:
#     file.write(app.toEsriGeometry(geo_j))
# app.toEsriGeometry(geo_j)

# geo_j = gt.shapely_to_geojson(buff)


# cp.find_ch4_peaks(cleanedDf)
# peaks = cleanedDf[cleanedDf['Peak'] == 1]
# peakList = []
# for i in peaks.index:
#     peakList.append((points[i].x, points[i].y))
# peakPoints = MultiPoint(peakList)
# outerBuffer = peakPoints.buffer(13.57884, resolution=8)
# geo_j = mapping(outerBuffer)
# result = app.toEsriGeometry(geo_j)
# print(json.loads(result)["rings"])

# # innerBuffer = peakPoints.buffer(5.876544, resolution=8)
# # # start = time.time()
# geo_j = gt.shapely_to_geojson(outerBuffer).replace('"', "'")
# # end = time.time()
# # print(end-start)
# print(geo_j)


# # with open("sample_polygon.json", "w") as file:
# #     file.write(geo_j)
# print(len(geo_j['coordinates']))



# for i in geojson:
#     testPeak.append(i[0])
# print(testPeak)



# cp.find_ch4_peaks(cleanedDf)
# print(cleanedDf)
# print(cleanedDf)
# print(cleanedDf.dtypes)

# # add a column of points
# gt.add_points_to_df(cleanedDf, "SenseLong", "SenseLat")
# peaks = cleanedDf[cleanedDf['Peak'] == 1]
# print(peaks)
# points = gt.series_to_multipoint(peaks["points"])
# # pre project the points to prepare for buffer.
# sr = gt.find_utm_zone(points[0].y, points[0].x)
# points = gt.reproject(points, sr)
# # print(points)





# conn = sqlite3.connect("/Users/apple/Desktop/python/internship/web_vue/web_viewer_back/web_app_db.sqlite")
# cursor = conn.cursor()
# cleanedDf[["Microsec", "Flight_Date", "SenseLong", "SenseLat", "CH4", "Peak", "Source_Name"]].to_sql(name="PointsTable", con=conn, if_exists='append', index=False)
# df.to_sql(name="PointsTable", con=conn, if_exists='append', index=False)





# count = 0
# index = 0
# for i in df["Peak"]:
#     if i == 1:
#         count += 1
#         print(index)
#     index += 1
# print(count)





# a = {"a":[1,1,3,10,10], "b":[2,2,4,8,8], "c":[5,5,7,0,9]}
# df = pd.DataFrame(a)
# print(df)
# # df = df.drop_duplicates(subset = ['a', 'b', 'c'], keep = 'first')
# c_maxes = df.groupby(['a', 'b']).c.transform(max)
# print(c_maxes)
# df2 = df.loc[df.c == c_maxes]
# # df2 = df2.drop_duplicates(subset = ['a', 'b', 'c'], keep = 'first')
# print(df2.reset_index())

# dt_obj = datetime.strptime('2022-06-20 15:30:58',
#                            '%Y-%m-%d %H:%M:%S')
# millisec = dt_obj.timestamp() * 1000

# print(millisec)


